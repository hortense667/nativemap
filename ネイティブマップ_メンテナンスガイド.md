# ネイティブマップ メンテナンスガイド

Copyright (c) 2025 Satoshi Endoh / @hortense667

## 概要

このガイドは、ネイティブマップの管理者向けの技術的な情報とメンテナンス手順を説明します。

## システム構成

### アーキテクチャ
- **フロントエンド**: HTML5 + JavaScript (nativemap101.html)
- **データストレージ**: GitHub API + localStorage
- **デプロイ**: GitHub Pages
- **認証**: GitHub Personal Access Token (PAT)

### ファイル構成
```
nativemap/
├── nativemap101.html          # メインアプリケーション
├── timeline.json              # データファイル（管理者のみ変更可能）
├── README.md                  # プロジェクト説明
├── LICENSE                    # ライセンス情報
├── ネイティブマップ_ユーザーガイド.md
└── ネイティブマップ_メンテナンスガイド.md
```

## 管理者権限の設定

### GitHubリポジトリの権限設定

#### 1. リポジトリの設定
- **リポジトリ**: hortense667/nativemap
- **可視性**: Public
- **GitHub Pages**: 有効

#### 2. ファイル権限の制限
- **timeline.json**: 管理者のみ変更可能
- **nativemap101.html**: 誰でも変更可能
- **その他のファイル**: 誰でも変更可能

#### 3. ブランチ保護ルール
```bash
# timeline.jsonの変更を制限するための設定
# GitHub Web UIで以下を設定：
# - Require pull request reviews before merging
# - Restrict pushes that create files matching "timeline.json"
```

### Personal Access Token (PAT) の管理

#### 管理者用PAT
- **スコープ**: repo (フルアクセス)
- **有効期限**: 無期限（推奨）
- **用途**: timeline.jsonの読み書き

#### 一般ユーザー用PAT
- **スコープ**: repo (フルアクセス)
- **有効期限**: 無期限（推奨）
- **用途**: timeline.jsonの読み取りのみ（実装上は書き込み権限が必要）

## データ管理

### データ構造
```json
{
  "1952": [
    {
      "label": "テレビ放送開始",
      "genre": "TVP",
      "imp": 5,
      "url": "https://ja.wikipedia.org/wiki/テレビ放送",
      "note": "日本初のテレビ放送開始"
    }
  ]
}
```

### データの整合性チェック
```javascript
// データ検証関数
function validateData(data) {
  const errors = [];
  for (const [year, items] of Object.entries(data)) {
    if (!Number.isInteger(parseInt(year)) || parseInt(year) < 1945 || parseInt(year) > 2059) {
      errors.push(`Invalid year: ${year}`);
    }
    for (const item of items) {
      if (!item.label) errors.push(`Missing label in ${year}`);
      if (item.genre && !GENRES.includes(item.genre)) {
        errors.push(`Invalid genre: ${item.genre} in ${year}`);
      }
      if (item.imp && (item.imp < 1 || item.imp > 5)) {
        errors.push(`Invalid importance: ${item.imp} in ${year}`);
      }
    }
  }
  return errors;
}
```

### バックアップ戦略
1. **GitHub**: 自動バックアップ（Git履歴）
2. **ローカル**: 定期的なtimeline.jsonのエクスポート
3. **外部**: 月次でのデータアーカイブ

## パフォーマンス管理

### 容量制限
- **現在の登録件数**: 743件
- **推奨上限**: 20,000件
- **絶対上限**: 100MB（GitHub API制限）

### パフォーマンス最適化
```javascript
// 大量データ対応の最適化
function optimizeForLargeData() {
  // 1. 仮想スクロールの実装
  // 2. 検索結果のページネーション
  // 3. フィルタリングの最適化
  // 4. メモリ使用量の監視
}
```

### 監視項目
- **ファイルサイズ**: 月次チェック
- **登録件数**: 週次チェック
- **同期エラー**: 日次チェック
- **ユーザーアクセス**: 月次レポート

## セキュリティ管理

### アクセス制御
- **timeline.json**: 管理者のみ変更可能
- **PAT管理**: 定期的なトークン更新
- **ログ監視**: 異常なアクセスパターンの検出

### データ保護
- **入力検証**: すべての入力データの検証
- **XSS対策**: 出力時のエスケープ処理
- **CSRF対策**: GitHub APIの認証トークン使用

## トラブルシューティング

### よくある問題

#### 1. 同期エラー
```javascript
// エラーログの確認
console.log('GitHub API Error:', error);
// 対処法：
// - PATの有効性確認
// - ネットワーク接続確認
// - GitHub API制限の確認
```

#### 2. データ破損
```javascript
// データ復旧手順
// 1. GitHubの履歴から復旧
// 2. バックアップからの復旧
// 3. 手動でのデータ修正
```

#### 3. パフォーマンス問題
```javascript
// パフォーマンス監視
function monitorPerformance() {
  const startTime = performance.now();
  // 処理実行
  const endTime = performance.now();
  console.log(`Processing time: ${endTime - startTime}ms`);
}
```

### 緊急時対応

#### データ復旧手順
1. **GitHub履歴確認**: 最新の正常なコミットを特定
2. **バックアップ復旧**: 最新のバックアップから復旧
3. **手動修正**: 必要に応じて手動でデータ修正
4. **検証**: データの整合性を確認

#### システム停止時の対応
1. **原因特定**: エラーログの確認
2. **緊急修正**: 必要に応じてコード修正
3. **復旧確認**: システムの正常動作確認
4. **ユーザー通知**: 影響範囲の通知

## 更新・メンテナンス

### 定期メンテナンス
- **週次**: エラーログの確認
- **月次**: データの整合性チェック
- **四半期**: セキュリティアップデート
- **年次**: システム全体の見直し

### 機能追加・改善
1. **要件定義**: 新機能の要件を明確化
2. **設計**: システム設計の検討
3. **実装**: コードの実装
4. **テスト**: 動作確認とテスト
5. **デプロイ**: 本番環境への反映
6. **監視**: リリース後の監視

## ライセンス管理

### CC BY-SA 4.0 ライセンス
- **データ**: Creative Commons Attribution-ShareAlike 4.0
- **プログラム**: MIT License
- **帰属表示**: 適切なクレジット表示の確認

### ライセンス遵守の確認
- **データ使用**: 適切な帰属表示の確認
- **派生作品**: 同一ライセンスでの公開確認
- **商用利用**: ライセンス条件の遵守確認

## ドキュメント管理

### 更新頻度
- **ユーザーガイド**: 機能追加時に更新
- **メンテナンスガイド**: システム変更時に更新
- **README**: プロジェクト変更時に更新

### バージョン管理
- **ドキュメント**: Gitでバージョン管理
- **変更履歴**: 更新内容の記録
- **レビュー**: 変更内容のレビュー

## 連絡先・サポート

### 管理者連絡先
- **GitHub**: hortense667
- **Issues**: GitHub Issuesで問題報告
- **Pull Requests**: 機能改善の提案

### サポート体制
- **一般ユーザー**: ユーザーガイドでの自己解決
- **技術的問題**: GitHub Issuesで報告
- **緊急時**: 管理者への直接連絡

---

**ネイティブマップ メンテナンスガイド** - 管理者向け技術情報