# ネイティブマップ ユーザーガイド

Copyright (c) 2025 Satoshi Endoh / @hortense667

## 概要

ネイティブマップは、年代別のイベントを視覚的に表示し、管理するためのWebアプリケーションです。縦軸に誕生年、横軸に年齢を設定し、各イベントがどの年代の人にとってどの年齢での出来事だったかを直感的に把握できます。

## アクセス方法

### アプリケーションを開く
以下のいずれかで開けます：
```
オンライン: https://hortense667.github.io/nativemap/nativemap101.html
ローカル:   http://localhost:8000/nativemap101.html （`server.js`で起動）
```

### ローカルでの起動方法（はじめてでも安心）
1. Node.js をインストール
   - 公式サイト（`https://nodejs.org`）から LTS 版をインストール
   - インストール後に以下で確認：
   ```
   node -v
   npm -v
   ```
2. 依存パッケージをインストール
   - プロジェクトのフォルダを開いて次を実行：
   ```
   npm install
   ```
3. サーバーを起動
   ```
   npm start
   ```
   - コンソールに「サーバーが起動しました: http://localhost:8000」と表示されます
4. ブラウザで開く
   - `http://localhost:8000/nativemap101.html`

ショートカット：
- Windows: `ネイティブマップ起動.bat` をダブルクリック
- macOS/Linux: `sh start_server.sh` または `npm start`

よくある疑問：
- 開かない/真っ白: ブラウザの再読み込み、キャッシュ削除、開発者ツールでエラー確認（F12）
- ポートが使われている: `server.js` の `PORT` を 8001 などに変更して再起動
- Nodeが見つからない: Node.js を再インストールし、PCを再起動

### Pythonがインストール済みの場合の簡易起動（代替手段）
Nodeを使わずにPythonの簡易サーバーで表示できます。

1. プロジェクトフォルダで次を実行（Python 3）
   ```
   python -m http.server 8000
   ```
   旧環境（Python 2）の場合：
   ```
   python -m SimpleHTTPServer 8000
   ```
2. ブラウザで開く
   - `http://localhost:8000/nativemap101.html`

メモ：Pythonの簡易サーバーは静的配信のみのため、追加機能はありません。

## 初回設定

### GitHub設定
1. **「設定」ボタン**をクリック
2. 設定情報を入力：

#### 一般ユーザー（管理者のデータを使用）
- **Personal Access Token**: 管理者から提供されたトークン
- **リポジトリ所有者**: 通常は「hortense667」
- **リポジトリ名**: 通常は「nativemap」
- **ファイルパス**: 通常は「timeline.json」

#### 独自データを使用する場合
独自のGitHubリポジトリでデータを管理したい場合は、以下の手順で設定してください：

1. **GitHubリポジトリの準備**
   - 新しいGitHubリポジトリを作成
   - リポジトリに`timeline.json`ファイルをアップロード

2. **Personal Access Tokenの作成**
   - GitHubの[Personal Access Tokens](https://github.com/settings/tokens)にアクセス
   - 「Generate new token (classic)」をクリック
   - スコープで「repo」を選択（読み取り・書き込みに使用）
   - トークンを生成し、安全な場所に保存

3. **設定の入力**
   - **Personal Access Token**: 作成したトークン
   - **リポジトリ所有者**: あなたのGitHubユーザー名
   - **リポジトリ名**: 作成したリポジトリ名
   - **ファイルパス**: 「timeline.json」（推奨）

4. **データ形式について**
   - `timeline.json`は以下の形式に対応しています（`events` + `eraSettings`）：
   ```json
   {
     "events": {
       "1952": [{"label": "テレビ放送開始"}],
       "1983": [{"label": "任天堂ファミコン", "genre": "GAM", "imp": 5 }]
     },
     "eraSettings": [
       {"enabled": true, "label": "テレビの時代", "start": 1950, "end": 1969, "fill": "#eef", "opacity": 0.3}
     ]
   }
   ```
   - 各イベントには以下の項目を設定できます：
     - `label`: イベント名（必須）
     - `genre`: ジャンル（ANI, MAN, GAM等）
     - `imp`: 重要度（1-5）
     - `url`: 関連URL
     - `note`: 注釈
   - 追加オプション: **`genres`（ジャンル定義）**をトップレベルに含めることで、アプリ内の利用可能なジャンル一覧を上書きできます。これにより、まったく新しいジャンルセットを定義して運用できます。
     - サポート形式1（推奨・配列型）:
       ```json
       {
         "genres": [
           {"code": "NEW", "label": "新ジャンル"},
           {"code": "ABC", "label": "独自カテゴリ"}
         ],
         "events": { /* ... */ },
         "eraSettings": [ /* ... */ ]
       }
       ```
     - サポート形式2（互換・オブジェクト型）:
       ```json
       {
         "genres": {
           "list": ["NEW", "ABC"],
           "labels": { "NEW": "新ジャンル", "ABC": "独自カテゴリ" }
         },
         "events": { /* ... */ },
         "eraSettings": [ /* ... */ ]
       }
       ```
     - 注意:
       - `code`は英大文字推奨。イベント内の`genre`も同じコードを使用します
       - `genres`を更新後は、設定画面から「表示中の全ラベルをクリアしてGitHubから読み込み」を実行すると最新のジャンルが反映されます

3. **「保存」ボタン**をクリック

### 共同編集（コラボレーターによるPAT利用）
- **概要**: 管理者のほか、管理者が招待したコラボレーターもGitHubで「Classic Token」を`repo`スコープで発行し、本アプリの「設定」画面の**Personal Access Token**に入力することで、同じ`timeline.json`を読み書きできます。
- **前提**:
  - コラボレーターは対象リポジトリに「Write」以上の権限で招待されていること
  - ブランチ保護やPR必須ルールがある場合は、運用ルールに従ってください
- **手順**:
  1. GitHubの`Settings > Developer settings > Personal access tokens > Tokens (classic)`へ
  2. 「Generate new token (classic)」をクリック
  3. **Scope**で`repo`を選択
  4. トークンを生成し、安全に保管
  5. 本アプリの「設定」で、生成したトークンを**Personal Access Token**に貼り付けて保存
- **注意**:
  - トークンは閲覧可能な場所に貼らないでください
  - 失効・漏えい時は即座にリボークし、新しいトークンを再発行してください
  - 同時編集を避けるため、編集開始前の「同期」と編集終了時の「同期」を必ず実施

### データの同期
- **「同期」ボタン**でGitHubから最新データを読み込み
- 編集前に必ず同期を実行してください
- 編集後は必ず**「同期」**でGitHubへ保存・反映してください（詳細一覧でのドラッグによる順序変更を含む）

## 基本操作

### イベントの表示
- **左側の年表示**でイベントを確認
- **マウスオーバー**で詳細情報を表示
- **クリック**で詳細一覧を表示

### 検索機能
- **検索ボックス**にキーワードを入力
- **「検索」ボタン**で実行
- **「前・次」ボタン**で結果を移動
- **ラベルと注釈**の両方を検索対象とします

### フィルタ機能
- **ジャンル選択**: 「ジャンル選択」ボタンで複数ジャンルを選択
- **重要度**: 1-5（選択値以下のみ表示）
- **時代区分**: 「時代区分」ボタンで背景色・透明度・名称を設定（最大8件）

## データの編集

重要：編集を開始する前に必ず**「同期」**で最新データを取得し、編集作業が終わったら必ず**「同期」**でGitHubへ保存・反映してください（並び替え・追加・削除・修正のすべてが対象）。

### 個別編集
1. **イベントをクリック**して詳細一覧を表示
2. **「ペンマーク」**をクリックして編集画面を開く
3. 以下の項目を編集：
   - **ラベル**: イベント名
   - **ジャンル**: プルダウンから選択
   - **重要度**: 1-5から選択
   - **URL**: 関連URL（Wikipedia等）
   - **注釈**: 詳細説明
4. **「保存」**で変更を確定

### 新規追加
1. **空の年をクリック**または詳細一覧で**「追加」**をクリック
2. 編集画面で項目を入力
3. **「保存」**で新規イベントを追加

### 一括追加（CSV/TSV読み込み）
1. **「ロード」ボタン**をクリック
2. CSV/TSVファイルを選択
3. 以下の形式でデータを準備：

```
年;ラベル;ジャンル;重要度;URL;注釈
1946;ENIAC;HAR;5;https://ja.wikipedia.org/wiki/ENIAC;初の大規模電子計算機
1983;任天堂ファミコン;GAM;5;https://ja.wikipedia.org/wiki/ファミリーコンピュータ;家庭用ゲーム機の革命
```

**注意事項：**
- 区切り文字は自動検出されます（タブ、セミコロン、カンマ）
- 1行目がヘッダーの場合は自動でスキップされます
- 年は4桁の数字で入力してください（1945-2059の範囲）
- ジャンルは大文字小文字を区別しません
- 重要度は1-5の数字で入力してください
- 同じラベル・ジャンル組み合わせは重複エラーになります

## ジャンル一覧

- **ANI**: アニメ
- **MAN**: マンガ
- **GAM**: ゲーム
- **TVP**: テレビ番組
- **MOV**: 映画
- **NET**: インターネット
- **HAR**: ハードウェア
- **PHE**: 現象・流行
- **SOF**: ソフトウェア
- **TOY**: おもちゃ
- **FAS**: ファッション
- **BOO**: 本
- **MAG**: 雑誌
- **NOV**: 小説
- **MUS**: 音楽
- **UNC**: その他
（拡張ジャンルにも対応：`IDL`, `RDO`, `EVT`, `FMT`, `SPW`, `RDE`, `FOO` など）

## 重要度

- **5**: 時代を代表する重要イベント
- **4**: 大きな影響を与えたイベント
- **3**: 一般的に知られているイベント
- **2**: 特定分野で重要なイベント
- **1**: 参考程度のイベント

## 高度な操作

### ドラッグ操作
- **誕生年の丸**をドラッグして年齢を調整
- イベントがどの年齢での出来事だったかを確認

### 詳細一覧の操作
- **ドラッグ&ドロップ**: 項目の順序変更
- **「地球儀マーク」**: URLを新しいタブで開く
- **「ペンマーク」**: 項目を編集
- **「ゴミ箱マーク」**: 項目を削除

### 時代区分機能（背景を色帯で可視化）
1. 右上の **「時代区分」** ボタンをクリックし、設定ダイアログを開きます。
2. 各行が1つの時代区分です。次を指定します：
   - **表示**: チェックでON/OFF（表示を一時停止したいときに便利）
   - **時代区分名**: 任意の名称（例: 「テレビ・マンガ・週刊誌の時代」）
   - **開始年・終了年**: 表示期間（1950〜2059の範囲で入力）
   - **塗色**: 色見本から選択（背景の帯色）
   - **透明度**: 10%〜80%（濃すぎる場合は下げる）
3. **「保存」**で反映されます（画面に帯が表示されます）。最大 **8件** まで設定できます。
4. 帯の重なりは上から順に描画されます。見え方を調整したい場合は色や透明度を調整してください。
5. 設定内容はローカルに保存され、再表示時も維持されます（GitHub保存の対象にもできます）。

ヒント：
- 重要な節目（例: 「インターネット普及期」「スマホ転換期」）を帯で区切ると、イベントの変化が一目で分かります。
- 透明度を高め（薄く）にすると、イベントテキストの可読性を損ないません。

### データ管理
- **「表示中の全ラベルをクリアしてGitHubから読み込み」**: ローカルデータをクリアして最新データを読み込み
- **ローカル保存**: `localStorage` に自動保存（編集フラグ、ラベルバックアップ、データ鮮度の記録）

## トラブルシューティング

### よくある問題

#### 同期エラー
- Personal Access Tokenが正しく設定されているか確認
- リポジトリ名、所有者名、ファイルパスが正しいか確認
- ネットワーク接続を確認
- 独自データ使用の場合は、リポジトリのアクセス権限を確認

#### データが表示されない
- 「同期」ボタンでGitHubからデータを読み込み
- ブラウザのキャッシュをクリア
- `timeline.json`の形式が正しいか確認

#### 編集が保存されない
- 「同期」ボタンでGitHubに保存
- ネットワーク接続を確認
- Personal Access Tokenに「repo」スコープが設定されているか確認

#### 独自データ使用時の注意点
- GitHubリポジトリがプライベートの場合は、Personal Access Tokenに適切な権限が必要
- `timeline.json`の形式は必ず以下の構造にしてください：
  ```json
  {
    "events": { ... },
    "eraSettings": [ ... ]
  }
  ```
- ファイルが存在しない場合は空のデータとして扱われます

### サポート
- 問題が解決しない場合は、管理者に問い合わせ
- バグ報告時は、ブラウザ情報とエラーメッセージを含める
- 独自データ使用の場合は、設定情報（リポジトリ名等）も含める

## ライセンス

このプロジェクトのデータは[CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)ライセンスの下で提供されます。

### データの使用について
- **表示**: 原作者のクレジットを表示
- **継承**: 派生作品も同じライセンスで公開
- **商用利用**: 可能
- **改変**: 可能

### 帰属表示の例
```
ネイティブマップ by hortense667 is licensed under CC BY-SA 4.0
https://github.com/hortense667/nativemap
```

## 更新履歴

### v1.0 (2025年)
- 初回リリース
- 基本的なタイムライン表示機能
- GitHub同期機能
- CSV/TSV読み込み機能
- 検索・フィルタ機能
- 16種類のジャンル分類
- 時代区分機能（背景色設定）
- 独自データ使用対応
- ドラッグ&ドロップによる項目順序変更

---

**ネイティブマップ** - 年代を超えたイベントの可視化ツール